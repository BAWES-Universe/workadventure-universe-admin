# Development Dockerfile for Admin API
# Runs behind Traefik at admin.bawes.localhost

FROM node:20.19-alpine

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies (skip postinstall to avoid prisma generate during build)
RUN npm install --ignore-scripts

# Copy all source code (needed for prisma generate and initial build)
COPY . .

# Generate Prisma Client (now that all files are in place)
# Temporarily rename prisma.config.ts since it requires DATABASE_URL during build
# prisma generate doesn't need DATABASE_URL - it only reads the schema file
RUN mv prisma.config.ts prisma.config.ts.bak && \
    npx prisma generate --schema=prisma/schema.prisma && \
    mv prisma.config.ts.bak prisma.config.ts

# Expose port (used by Traefik)
EXPOSE 3333

# Start development server
# Next.js dev server binds to 0.0.0.0 by default in Docker
CMD ["npm", "run", "dev"]

